mongodb
curl -O https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-rhel62-4.0.2.tgz
tar -zxvf mongodb-linux-x86_64-rhel62-4.0.2.tgz
mv mongodb-linux-x86_64-4.0.2/ /usr/local/mongodb
export PATH=/usr/local/mongodb/bin:$PATH
mkdir -p /home/mongodb/data/logs/
mkdir -p /home/mongodb/data/db/
touch /home/mongodb/data/logs/mongodb.log

1：/usr/local/etc/mongod.conf

processManagement:
   fork: true

systemLog:
  destination: file
  path: /home/mongodb/data/logs/mongodb.log
  logAppend: true

storage:
  dbPath: /home/mongodb/data/db

net:
  bindIp: 0.0.0.0
  port: 27017

security:
   authorization: enabled

2：命令行执行
echo never >>  /sys/kernel/mm/transparent_hugepage/enabled
echo never >>  /sys/kernel/mm/transparent_hugepage/defrag

3: vim /etc/security/limits.conf
mongod  soft  nofile  64000
mongod  hard  nofile  64000
mongod  soft  nproc  32000
mongod  hard  nproc  32000

4:vim /etc/profile
ulimit -f unlimited
ulimit -t unlimited
ulimit -v unlimited
ulimit -n 64000
ulimit -m unlimited
ulimit -u 64000

source /etc/profile

启动
/usr/local/mongodb/bin/mongod --config /usr/local/etc/mongod.conf

创建超级用户
use admin
db.system.users.remove({user:"root"})
db.system.users.find()
db.createUser(
    {
        user:"root",
        pwd:"111111",
        roles:[ {role:"root", db:"admin" }, { role:"userAdminAnyDatabase", db:"admin" } ]
    }
)
quit()



检查：
ps aux | grep mongodb
cat /proc/{mongodb PID}/limits

Max processes             64000                64000                processes
Max open files            64000                64000                files

ulimit -a
open files                      (-n) 64000
max user processes              (-u) 64000

bpcs_uploader：
yum install php
yum install  curl
git clone https://github.com/oott123/bpcs_uploader.git
chmod +x bpcs_uploader.php
./bpcs_uploader.php quickinit
./bpcs_uploader.php upload 本地文件 百度云文件夹/文件名

数据库备份
脚本：mongod_bak.sh
crontab：0 3 * * * /usr/local/ZhiliangkuOnline/doc/site_service/mongodb/mongod_bak.sh